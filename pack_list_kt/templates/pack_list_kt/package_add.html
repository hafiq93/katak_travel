{% block content %}
{% load static %}
<link rel="stylesheet" href="{% static 'src/styles.css' %}">
<html>
    
     <!-- Include the header -->
     {% include 'base_kt/admin_header.html' %}

     <body>
        <div class="flex h-min-screen">
            <!-- Main Content -->
            <div class="p-4 bg-gray-100 w-full">
                <!-- First Row (Metrics in One Row) -->
                <div class="rounded-md">
                    <div class="bg-white p-6 rounded-lg shadow-lg w-full">
                        <h2 class="text-2xl font-bold mb-4">Add Package</h2>
                    
                        <!-- Start Grid Layout -->
                        <div class="grid grid-rows-1 gap-4">
                        <!-- Add Hotel Form -->
                            <form method="POST" action="{% if package and package.id %}{% url 'pack_list_add' id=package.id %}{% else %}{% url 'pack_list_add' %}{% endif %}"  enctype="multipart/form-data">
                                {% csrf_token %}
                                <!-- Package Name -->
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                    <div class="mb-4 col-span-1 md:col-span-2">
                                        <label for="hotel_name" class="block text-gray-700 font-semibold">Package Name:</label>
                                        <input type="text" id="hotel_name" name="hotel_name" 
                                            value="{% if package %}{{ package.name }}{% else %}{% endif %}" 
                                            required class="mt-1 p-2 border border-gray-300 rounded w-full" required>
                                    </div>
                                    <div class="mb-4 col-span-1 ">
                                        <label for="hotel_name" class="block text-gray-700 font-semibold">Package Code:</label>
                                        <input type="text" id="code" name="code" 
                                            value="{% if package %}{{ package.code }}{% else %}{% endif %}" 
                                            required class="mt-1 p-2 border border-gray-300 rounded w-full " required >
                                    </div>
                                    <div class="mb-4 col-span-1">
                                        <label for="merchant_type" class="block text-gray-700 font-semibold">Category (Merchant Type):</label>
                                        <select id="merchant_type" name="merchant_type" class="mt-1 p-2 border border-gray-300 rounded w-full" required>
                                            <option value="" disabled selected>Select a category</option>
                                            {% for type in merchant_types %}
                                                <option value="{{ type.id }}"
                                                    {% if package and package.pack_categories.first.merchant_type.id == type.id %}selected{% endif %}>
                                                    {{ type.name }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                
                                    <div class=" col-span-2">
                                        <div class="mb-4 flex space-x-4">
                                            <!-- City Input -->
                                            <div class="flex-1">
                                                <label for="city" class="block text-gray-700 font-semibold">City:</label>
                                                <input type="text" id="city" name="city" 
                                                    value="{% if package %}{{ package.city }}{% else %}{% endif %}" 
                                                    required class="mt-1 p-2 border border-gray-300 rounded w-full" placeholder="Enter City" >
                                            </div>
                                            
                                            <!-- Country Dropdown -->
                                            <div class="flex-1">
                                                <label for="location" class="block text-gray-700 font-semibold">Country:</label>
                                                <select id="location" name="location" required class="mt-1 p-2 border border-gray-300 rounded w-full">
                                                    <option value="">Select a Country</option>
                                                    {% for loc in locations %}
                                                        <option value="{{ loc.country }}" {% if loc.country == package.location.country %}selected{% endif %}>{{ loc.country }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class=" col-span-2">
                                    <!-- Pax Range -->
                                        <div class="mb-4">
                                            <label class="block text-gray-700 font-semibold">Pax Range:</label>
                                            <div class="flex space-x-4">
                                                <!-- Minimum Pax -->
                                                <div class="w-1/2">
                                                    <input type="number" id="min_pax" name="min_pax" min="1" required 
                                                        value="{% if package %}{{ package.min_pax }}{% else %}{% endif %}"
                                                        placeholder="Min Pax" class="mt-1 p-2 border border-gray-300 rounded w-full">
                                                </div>
                                                
                                                <!-- Maximum Pax -->
                                                <div class="w-1/2">
                                                    <input type="number" id="max_pax" name="max_pax" min="1" required 
                                                        value="{% if package %}{{ package.max_pax }}{% else %}{% endif %}"
                                                        placeholder="Max Pax" class="mt-1 p-2 border border-gray-300 rounded w-full">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            
                            
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">

                                    <div class="mb-4">
                                        <label for="date_of_travel" class="block text-gray-700 font-semibold mb-2">Date of Travel:</label>
                                        <textarea id="date_of_travel" name="date_of_travel" rows="6"
                                                placeholder="Enter the date of travel:"
                                                class="p-2 border border-gray-300 rounded w-full resize-y">{% if package %}{{ package.date_of_travel }}{% endif %}</textarea>
                                    </div>
                            
                                    <div class="mb-4">
                                        <label for="description" class="block text-gray-700 font-semibold mb-2">Package Description:</label>
                                        <textarea id="description" name="description" rows="6"
                                                  placeholder="Enter the description of the package"
                                                  class="p-2 border border-gray-300 rounded w-full resize-y">
                                            {% if package %}{{ package.description|safe }}{% endif %}
                                        </textarea>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <label for="info" class="block text-gray-700 font-semibold mb-2">Package Information:</label>
                                        <textarea id="info" name="info" rows="6"
                                                  placeholder="Enter additional information about the package"
                                                  class="p-2 border border-gray-300 rounded w-full resize-y">
                                            {% if package %}{{ package.info|safe  }}{% endif %}
                                        </textarea>
                                    </div>
                                </div>


                                
                                
                                <!-- Package Duration -->
                                <div class="mb-4">
                                    <label class="block text-gray-700 font-semibold mb-2">Package Duration Publish:</label>
                                    <div class="flex items-center space-x-2">
                                        <!-- Start Date -->
                                        <input type="text" id="start_date" name="start_date" 
                                            value="{% if package %}{{ package.start_date|date:'d/m/Y' }}{% else %}{% endif %}" 
                                            placeholder="Start Date (dd/mm/yyyy)" required class="p-2 border border-gray-300 rounded w-1/3">
                                        
                                        <!-- End Date -->
                                        <input type="text" id="end_date" name="end_date" 
                                            value="{% if package %}{{ package.end_date|date:'d/m/Y' }}{% else %}{% endif %}" 
                                            placeholder="End Date (dd/mm/yyyy)" required class="p-2 border border-gray-300 rounded w-1/3">
                                        
                                        <!-- Duration -->
                                        <input type="text" id="duration" name="duration" placeholder="Duration (Days)" readonly 
                                            value="{% if package %}{{ package.duration }} days {% else %}{% endif %}"
                                            class="p-2 border border-gray-300 rounded w-1/3 bg-gray-100">
                                            
                                    </div>
                                </div>
                                
                                <!-- Submit and Cancel Buttons -->
                                <div class="flex justify-between mt-6">
                                
                            
                                    <div class="flex space-x-2">
                                        <button type="submit" class="bg-blue-700 text-white px-4 py-2 rounded hover:bg-blue-600 font-semibold inline-flex items-center">
                                            <i class="fas fa-paper-plane mr-2"></i> Submit
                                        </button>
                                        
                                      
                                    </div>
                                </div>
                            </form>
                        </div>

                        <div class="grid grid-rows-1 gap-4">

                         <!-- Package Description -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

                                <!-- Main Image Upload -->
                            <!-- Main Image Upload -->
                                <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">

                                <div class="mb-4">
                                    <label for="main_image" class="block text-gray-700 font-semibold mb-2">Main Image:</label>
                                    <input 
                                        type="file" 
                                        id="main_image" 
                                        name="main_image" 
                                        accept="image/*"
                                        class="p-2 border border-gray-300 rounded w-full"
                                        onchange="previewMainImage(this)"
                                    >
                                
                                    <div id="main_image_preview" class="mt-2 flex flex-col gap-4 bg-white">
                                        {% if main_image %}
                                            <!-- ðŸ–¼ï¸ Image Preview -->
                                            <div class="relative inline-block">
                                                <img src="{{ main_image.image.url }}" 
                                                    class="rounded-md shadow-sm" 
                                                    style="width: 300px; height: 150px; object-fit: cover;">
                                            </div>
                                
                                            <!-- ðŸ”˜ Buttons -->
                                            <div class="flex flex-col justify-start gap-4 w-[300px]">
                                                <button 
                                                    type="button" 
                                                    data-image-id="{{ main_image.id }}" 
                                                    onclick="deleteMainImage(this)"
                                                    class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-700 w-3/6 font-semibold"
                                                >
                                                <i class="fas fa-trash-alt mr-2"></i>Delete 
                                                </button>
                                
                                                <button 
                                                    id="upload_main_image" 
                                                    type="button" 
                                                    class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-700 w-3/6 font-semibold"
                                                    onclick="uploadImage()"
                                                >
                                                <i class="fas fa-upload mr-2"></i> Upload
                                                </button>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>

                                <!-- Other Images Upload -->
                                <!-- Other Images Upload -->
                                <div class="mb-2">
                                    <label for="other_images" class="block text-gray-700 font-semibold mb-2">Other Images (Max 4):</label>
                                    <input 
                                        type="file" 
                                        id="other_images" 
                                        name="other_images[]" 
                                        accept="image/*" 
                                        multiple 
                                        class="p-2 border border-gray-300 rounded w-full"
                                        onchange="previewOtherImages(this)"
                                    >
                                
                                    <!-- Image preview grid -->
                                    <div id="other_image_preview" class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-4 gap-4 mt-2">
                                        {% for img in other_images %}
                                            <div class="flex flex-col gap-2" data-image-id="{{ img.id }}">
                                                <img src="{{ img.image.url }}" class="rounded shadow-md items-center w-full" style=" height: 150px; object-fit: cover;">
                                
                                                <!-- ðŸ‘‡ Full-size Delete button below the image -->
                                                <div class="flex justify-start w-[300px]">
                                                    <button 
                                                        type="button" 
                                                        onclick="deleteExistingImage({{ img.id }})"
                                                        class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-700 font-semibold w-3/6 mt-2 "
                                                    >
                                                    <i class="fas fa-trash-alt mr-2"></i>Delete
                                                    </button>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                
                                    <!-- Upload button (single) -->
                                    <div class="flex justify-start mt-4 w-[300px]">
                                        <button 
                                            id="upload_other_images" 
                                            type="button"
                                            class="bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-700 font-semibold w-3/6"
                                            onclick="uploadOtherImages()"
                                        >
                                        <i class="fas fa-upload mr-2"></i>Upload
                                        </button>
                                    </div>
                                </div>

                                    <!-- Upload button -->
                             
                            </div>
                            <div class="flex justify-between mt-4">
                                <a href="{% url 'package_list' %}" class="bg-red-700 text-white px-4 py-2 rounded hover:bg-red-600 mr-2 font-semibold inline-flex items-center">
                                    <i class="fas fa-times mr-2"></i> Cancel
                                </a>
                        
                                <div class="flex space-x-2">
                                
                                    <a href="{% if package and package.id %}{% url 'pack_price' package_id=package.id %}{% else %}#{% endif %}" 
                                    class="bg-green-700 text-white px-4 py-2 rounded font-semibold inline-flex items-center 
                                            {% if not package or not package.id %}cursor-not-allowed opacity-50{% endif %}">
                                        Next
                                        <i class="fas fa-arrow-right ml-2"></i>
                                    </a>
                                </div>
                            </div>
                        </div>


                    
                        {% if messages %}
                            {% for message in messages %}
                                <div class="mt-2 p-3 rounded 
                                    {% if message.tags == 'success' %}bg-green-100 text-green-700
                                    {% elif message.tags == 'error' %}bg-red-100 text-red-700
                                    {% endif %}">
                                    {{ message }}
                                </div>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const container = document.getElementById('merchant-container');
    
        // Add merchant field
        container.addEventListener('click', function (e) {
            if (e.target.classList.contains('add-merchant')) {
                const newField = document.createElement('div');
                newField.className = "flex items-center mt-2";
                newField.innerHTML = `
                    <input type="text" name="merchant[]" required 
                        class="p-2 border border-gray-300 rounded w-full">
                    <button type="button" class="ml-2 p-2 bg-red-500 text-white rounded delete-merchant">Delete</button>
                `;
                container.appendChild(newField);
            }
        });
    
        // Delete merchant field
        container.addEventListener('click', function (e) {
            if (e.target.classList.contains('delete-merchant')) {
                e.target.parentElement.remove();
            }
        });
    });
    </script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const startDateInput = document.getElementById('start_date');
        const endDateInput = document.getElementById('end_date');
        const durationInput = document.getElementById('duration');

        function calculateDuration() {
            const startDate = new Date(startDateInput.value);
            const endDate = new Date(endDateInput.value);

            if (startDate && endDate && endDate >= startDate) {
                const duration = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)); // in days
                durationInput.value = duration + " day(s)";
            } else {
                durationInput.value = "";
            }
        }

        startDateInput.addEventListener('change', calculateDuration);
        endDateInput.addEventListener('change', calculateDuration);
    });
</script>
<script>
    $(document).ready(function () {
        // Initialize Datepicker with dd/mm/yy format
        $("#start_date, #end_date").datepicker({
            dateFormat: 'dd/mm/yy',
            onSelect: function () {
                calculateDuration();
            }
        });

        function calculateDuration() {
            var startDate = $("#start_date").val();
            var endDate = $("#end_date").val();

            if (startDate && endDate) {
                var partsStart = startDate.split('/');
                var partsEnd = endDate.split('/');

                var start = new Date(partsStart[2], partsStart[1] - 1, partsStart[0]);
                var end = new Date(partsEnd[2], partsEnd[1] - 1, partsEnd[0]);

                var diffTime = end - start;
                var diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                if (diffDays >= 0) {
                    $("#duration").val(diffDays + " day(s)");
                } else {
                    $("#duration").val("");
                    alert("End Date must be after Start Date.");
                }
            }
        }
    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const minPaxInput = document.getElementById('min_pax');
        const maxPaxInput = document.getElementById('max_pax');

        maxPaxInput.addEventListener('input', function () {
            if (parseInt(minPaxInput.value) > parseInt(maxPaxInput.value)) {
                alert("Minimum Pax cannot be greater than Maximum Pax.");
                maxPaxInput.value = "";
            }
        });
    });
</script>
<script>
    $(document).ready(function() {
        $('#location').select2({
            placeholder: 'Select a Country',
            allowClear: true
        });
    });
</script>

<!-- Add JavaScript to Handle Adding/Removing Rows -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const addTravelDateButton = document.getElementById('add-travel-date');
        const travelDatesContainer = document.getElementById('travel-dates-container');

        // Initialize Flatpickr on existing inputs
        function initializeDatePickers() {
            flatpickr('.start-date', {
                dateFormat: "d/m/Y",
            });
            flatpickr('.end-date', {
                dateFormat: "d/m/Y",
            });
        }

        // Initialize Flatpickr for existing rows
        initializeDatePickers();

        // Function to add a new travel date row
        addTravelDateButton.addEventListener('click', function () {
            const newRow = document.createElement('div');
            newRow.classList.add('flex', 'items-center', 'space-x-2', 'mb-2', 'travel-date-row');
            newRow.innerHTML = `
                <input type="text" class="start-date p-2 border border-gray-300 rounded w-1/3" 
                       placeholder="Start Date (dd/mm/yyyy)" required>
                <input type="text" class="end-date p-2 border border-gray-300 rounded w-1/3" 
                       placeholder="End Date (dd/mm/yyyy)" required>
                <input type="text" name="duration[]" placeholder="Duration (Days)" readonly 
                       class="p-2 border border-gray-300 rounded w-1/3 bg-gray-100 duration">
                <button type="button" class="remove-travel-date bg-red-600 text-white px-3 py-2 rounded">
                    Remove
                </button>
            `;
            travelDatesContainer.appendChild(newRow);
            initializeDatePickers(); // Re-initialize Flatpickr for new inputs
        });

        // Function to remove a travel date row
        travelDatesContainer.addEventListener('click', function (event) {
            if (event.target.classList.contains('remove-travel-date')) {
                event.target.parentElement.remove();
            }
        });

        // Automatically calculate duration when start or end date changes
        travelDatesContainer.addEventListener('input', function (event) {
            if (event.target.classList.contains('start-date') || event.target.classList.contains('end-date')) {
                const row = event.target.parentElement;
                const startDateInput = row.querySelector('.start-date');
                const endDateInput = row.querySelector('.end-date');
                const durationInput = row.querySelector('.duration');

                if (startDateInput.value && endDateInput.value) {
                    const startDate = new Date(startDateInput.value.split('/').reverse().join('-'));
                    const endDate = new Date(endDateInput.value.split('/').reverse().join('-'));

                    if (!isNaN(startDate) && !isNaN(endDate)) {
                        const duration = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
                        durationInput.value = duration > 0 ? `${duration} days` : 'Invalid Date';
                    } else {
                        durationInput.value = 'Invalid Date';
                    }
                } else {
                    durationInput.value = '';
                }
            }
        });
    });
</script>

<!-- for main image -->
<script>
function previewMainImage(input) { 
    const preview = document.getElementById('main_image_preview');

    // Remove only image previews
    const allPreviews = preview.querySelectorAll('.relative');
    allPreviews.forEach(el => el.remove());

    const file = input.files[0];

    if (file && file.type.startsWith("image/")) {
        const reader = new FileReader();

        reader.onload = function (e) {
            // ðŸ–¼ï¸ Image preview wrapper
            const wrapper = document.createElement('div');
            wrapper.classList.add('relative', 'inline-block');

            const img = document.createElement('img');
            img.src = e.target.result;
            img.classList.add('rounded', 'shadow-md');
            img.style.width = "300px";
            img.style.height = "150px";
            img.style.objectFit = "cover";

            wrapper.appendChild(img);

            // Insert image preview before existing buttons (if any)
            const buttonsDiv = preview.querySelector('.flex');
            if (buttonsDiv) {
                preview.insertBefore(wrapper, buttonsDiv);
            } else {
                preview.appendChild(wrapper);
            }

            // âœ… Add buttons if they donâ€™t exist
            if (!preview.querySelector('.flex')) {
                const newButtonsDiv = document.createElement('div');
                newButtonsDiv.classList.add('flex', 'flex-col', 'gap-4', 'mt-2');

                // ðŸ”´ Delete Button
                const deleteButton = document.createElement('button');
                deleteButton.type = 'button';
                deleteButton.classList.add(
                    'bg-red-500', 'text-white', 'px-4', 'py-2', 'rounded',
                    'hover:bg-red-700', 'w-3/6', 'font-semibold',
                    'flex', 'items-center', 'justify-center', 'gap-2'
                );
                deleteButton.onclick = function () {
                    deleteMainImage(this);
                };

                const deleteIcon = document.createElement('i');
                deleteIcon.classList.add('fas', 'fa-trash-alt');
                deleteButton.appendChild(deleteIcon);
                deleteButton.appendChild(document.createTextNode('Delete Image'));

                // ðŸ”µ Upload Button
                const uploadButton = document.createElement('button');
                uploadButton.type = 'button';
                uploadButton.classList.add(
                    'bg-blue-500', 'text-white', 'px-4', 'py-2', 'rounded',
                    'hover:bg-blue-700', 'w-3/6', 'font-semibold',
                    'flex', 'items-center', 'justify-center', 'gap-2'
                );
                uploadButton.onclick = function () {
                    uploadImage();
                };

                const uploadIcon = document.createElement('i');
                uploadIcon.classList.add('fas', 'fa-upload','mr-2');
                uploadButton.appendChild(uploadIcon);
                uploadButton.appendChild(document.createTextNode('Upload Image'));

                // Append to container
                newButtonsDiv.appendChild(deleteButton);
                newButtonsDiv.appendChild(uploadButton);
                preview.appendChild(newButtonsDiv);
            }
        };

        reader.readAsDataURL(file);
    }
}

let uploadedImages = [];
let existingImageCount = document.querySelectorAll('[data-image-id]').length;

function previewOtherImages(input) {
    const previewContainer = document.getElementById('other_image_preview');

    // ðŸ” Count only images from the DB
    const existingImages = previewContainer.querySelectorAll('div[data-image-id]');
    existingImageCount = existingImages.length;

    const files = Array.from(input.files);
    const totalSelected = files.length + existingImageCount;

    if (totalSelected > 4) {
        alert(`You can only upload ${4 - existingImageCount} more image(s).`);
        input.value = "";
        uploadedImages = [];
        return;
    }

    uploadedImages = files;

    // Remove previous previews
    previewContainer.querySelectorAll(".new-image").forEach(el => el.parentElement.remove());

    files.forEach((file, index) => {
        if (file.type.startsWith("image/")) {
            const reader = new FileReader();
            reader.onload = function (e) {
                const wrapper = document.createElement("div");
                wrapper.className = "flex flex-col gap-2 new-image ";
                wrapper.style.width = "100%";

                const img = document.createElement("img");
                img.src = e.target.result;
                img.className = "rounded shadow-md w-full";
                img.style.height = "150px";
                img.style.objectFit = "cover";

                const deleteButton = document.createElement("button");
                deleteButton.type = "button";
                deleteButton.classList.add(
                    'bg-red-500', 'text-white', 'px-4', 'py-2', 'rounded',
                    'hover:bg-red-700', 'font-semibold', 'w-3/6',
                    'flex', 'items-center', 'justify-center', 'gap-2', 'mt-2'
                );
                deleteButton.innerHTML = `<i class="fas fa-trash-alt mr-2"></i>Delete`;

                deleteButton.onclick = () => {
                    uploadedImages.splice(index, 1);
                    input.files = createFileList(uploadedImages);
                    previewOtherImages(input);
                };

                wrapper.appendChild(img);
                wrapper.appendChild(deleteButton);

                const outer = document.createElement("div");
                outer.className = "flex justify-start ";  // ðŸ‘ˆ your custom wrapper
                outer.appendChild(wrapper);

                previewContainer.appendChild(outer);
            };
            reader.readAsDataURL(file);
        }
    });
}

function createFileList(files) {
    const dataTransfer = new DataTransfer();
    files.forEach(file => dataTransfer.items.add(file));
    return dataTransfer.files;
}

// Upload Main Image
function uploadImage() {
    console.log("Upload Main Image button clicked");
    const mainImageInput = document.getElementById('main_image');
    const file = mainImageInput.files[0];

    if (file && file.type.startsWith("image/")) {
        const formData = new FormData();
        formData.append("main_image", file);  // Match with your Django view

        fetch("{% url 'upload_main_image' package.id %}", {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const preview = document.getElementById('main_image_preview');
                
                // Clear the preview but keep the buttons
                preview.innerHTML = "";

                // Add the new image preview
                const img = document.createElement('img');
                img.src = data.image_url;
                img.classList.add('rounded', 'shadow-md');
                img.style.width = "300px";
                img.style.height = "150px";
                img.style.objectFit = "cover";
                preview.appendChild(img);

                // Append buttons back (Delete and Upload)
                const buttonsDiv = document.createElement('div');
                buttonsDiv.classList.add('flex', 'flex-col', 'gap-4', 'mt-2');

                // ðŸ”´ Delete Button
                const deleteButton = document.createElement('button');
                deleteButton.type = 'button';
                deleteButton.classList.add(
                    'bg-red-500', 'text-white', 'px-4', 'py-2', 'rounded',
                    'hover:bg-red-700', 'w-3/6', 'font-semibold',
                    'flex', 'items-center', 'justify-center', 'gap-2'
                );
                deleteButton.onclick = function () {
                    deleteMainImage(data.image_id);
                };

                const deleteIcon = document.createElement('i');
                deleteIcon.classList.add('fas', 'fa-trash-alt');  // Font Awesome trash icon
                deleteButton.appendChild(deleteIcon);
                deleteButton.appendChild(document.createTextNode('Delete Image'));

                // ðŸ”µ Upload Button
                const uploadButton = document.createElement('button');
                uploadButton.type = 'button';
                uploadButton.classList.add(
                    'bg-blue-500', 'text-white', 'px-4', 'py-2', 'rounded',
                    'hover:bg-blue-700', 'w-3/6', 'font-semibold',
                    'flex', 'items-center', 'justify-center', 'gap-2'
                );
                uploadButton.onclick = function () {
                    uploadImage();
                };

                const uploadIcon = document.createElement('i');
                uploadIcon.classList.add('fas', 'fa-upload', 'mr-2');  // Font Awesome upload icon
                uploadButton.appendChild(uploadIcon);
                uploadButton.appendChild(document.createTextNode('Upload Image'));

                // Append to DOM
                buttonsDiv.appendChild(deleteButton);
                buttonsDiv.appendChild(uploadButton);
                preview.appendChild(buttonsDiv);
            } else {
                alert("Error uploading image");
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert("There was an error uploading the image.");
        });
    }
}

function uploadOtherImages() {
    console.log("Upload Other Images button clicked");

    const otherImagesInput = document.getElementById('other_images');
    const files = Array.from(otherImagesInput.files);
    console.log("Selected files:", files);

    if (files.length > 0) {
        const formData = new FormData();
        files.forEach(file => formData.append("other_images[]", file));

        fetch("{% url 'upload_other_images' package.id %}", {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const previewContainer = document.getElementById('other_image_preview');
                previewContainer.innerHTML = ''; // Clear everything

                // Render all existing images (including newly added)
                if (data.existing_images) {
                    data.existing_images.forEach(img => {
                         // Outer wrapper div
                        const outerWrapper = document.createElement('div');
                        outerWrapper.classList.add('flex', 'justify-start', 'w-full');
                        
                        const wrapper = document.createElement('div');
                        wrapper.classList.add('flex', 'flex-col', 'gap-2');
                        wrapper.setAttribute('data-image-id', img.id);

                        const image = document.createElement('img');
                        image.src = img.url;
                        image.classList.add('rounded', 'shadow-md', 'items-left');
                        image.style.height = '150px';
                        image.style.objectFit = 'cover';

                        const deleteButton = document.createElement('button');
                        deleteButton.type = 'button';
                        deleteButton.classList.add(
                            'bg-red-500', 'text-white', 'px-4', 'py-2', 'rounded',
                            'hover:bg-red-700', 'font-semibold', 'w-3/4', 'mt-2'
                        );
                        deleteButton.onclick = function () {
                            deleteExistingImage(img.id);
                        };

                        const deleteIcon = document.createElement('i');
                        deleteIcon.classList.add('fas', 'fa-trash-alt', 'mr-2');
                        deleteButton.appendChild(deleteIcon);
                        deleteButton.appendChild(document.createTextNode('Delete'));

                        wrapper.appendChild(image);
                        wrapper.appendChild(deleteButton);
                        previewContainer.appendChild(wrapper);
                    });
                }

                // Reset input
                document.getElementById('other_images').value = '';
            } else {
                alert("Error uploading images");
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert("There was an error uploading the images.");
        });
    }
}


function getCsrfToken() {
    return document.querySelector('[name=csrfmiddlewaretoken]').value;
}
    </script>

<!-- delete image maain -->
    <script>
        function deleteMainImage(button) {
    const imageId = button.getAttribute("data-image-id");

    if (!imageId) {
        alert("No image ID provided.");
        return;
    }

    if (confirm("Are you sure you want to delete the main image?")) {
        fetch(`/package/delete-main-image/${imageId}/`, {
            method: "DELETE",
            headers: {
                "X-CSRFToken": getCsrfToken()
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.getElementById("main_image_preview").innerHTML = "";
            } else {
                alert("Failed to delete image.");
            }
        })
        .catch(error => {
            console.error("Error deleting main image:", error);
            alert("Something went wrong.");
        });
    }
}


// AJAX delete function for existing image
function deleteExistingImage(imageId) {
    if (!confirm("Are you sure you want to delete this image?")) return;

    fetch(`/package/delete-image/${imageId}/`, {
        method: "DELETE",
        headers: {
            "X-CSRFToken": getCsrfToken()
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            const imageDiv = document.querySelector(`[data-image-id="${imageId}"]`);
            if (imageDiv) imageDiv.remove();

            existingImageCount--;  // Update the counter
        } else {
            alert("Failed to delete image.");
        }
    })
    .catch(err => {
        console.error(err);
        alert("Error deleting image.");
    });
}

function getCsrfToken() {
    return document.querySelector('[name=csrfmiddlewaretoken]').value;
}
    </script>
{% endblock %}