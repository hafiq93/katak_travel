{% block content %}
{% load static %}
<link rel="stylesheet" href="{% static 'src/styles.css' %}">
<html>
    {% include 'base_kt/admin_header.html' %}
    <body>
        <div class="flex h-min-screen">
            <!-- Main Content -->
            <div class="p-4 bg-gray-100 w-full">
                <div class="rounded-md space-y-2">
                    <div class="bg-white p-6 rounded-lg shadow-lg w-full">
                        <h2 class="text-2xl font-bold mb-4">Form Details Package</h2>
                      
                        <form method="POST" action="" enctype="multipart/form-data">
                            {% csrf_token %}
                            <!-- Merchant Details -->
                           
                            <div class="grid grid-cols-1 gap-4 mb-4">
                                <h3 class="text-xl font-bold mb-4">Product Details</h3>
                        
                                <!-- Product Details Form -->
                                <div id="product-details-section">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 product-entry">
                                        <div class="md:col-span-1">
                                            <label for="product_name" class="block text-gray-700 font-semibold">Product Name:</label>
                                            <input type="text" id="product_name" name="product_name"
                                                   value="{{ product.product_name }}"
                                                   class="mt-1 p-2 border border-gray-300 rounded w-full" required>

                                            

                                            <label for="product_description" class="block text-gray-700 font-semibold mt-4">Description:</label>
                                            <textarea id="product_description" name="product_description"
                                                      class="mt-1 p-2 border border-gray-300 rounded w-full" rows="3" required>{{ product.product_description }}</textarea>
                                        
                                                      <label for="product_image" class="block text-gray-700 font-semibold mt-4">Image:</label>
                                            <input type="file" id="product_image" name="product_image" accept="image/*"
                                                    class="mt-1 p-2 border border-gray-300 rounded w-full">
                                            <p class="text-xs text-gray-600">
                                                File size must not exceed 400KB, only allow .jpg, .jpeg, .png, .gif, .webp file types
                                                <br>Recommend size 400x300(px); 640x480(px) SD / ratio 4:3
                                            </p>
                                        </div>
                            
                                       
                                            
                                   
                                        
                                        {% if product.product_image %}
                                            <div class="mt-4">
                                                <!-- <label class="block text-gray-700 font-semibold">Current Image:</label> -->
                                                <!-- <p class="text-gray-600 mt-2">{{ product.product_image.name }}</p> -->
                                                <div id="preview-container-1" class="bg-gray-100 border rounded p-2 h-80">
                                                    <img src="{{ product.product_image.url }}" alt="{{ product.product_name }}" 
                                                    class="w-full h-full object-scale-down ">
                                                </div>
                                                
                                                
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                     

                        <h3 class="text-xl font-bold mb-4">Add Price</h3>
                        {% csrf_token %}
                        <p class="font-semibold text-md">Adult Price</p>
                        <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-4" id="adult-row">
                            <div>
                                <label for="adult_number" class="block text-gray-700 font-semibold">Number of Adults</label>
                                <input type="number" id="adult_number" name="adult_number" class="mt-1 p-2 border border-gray-500 rounded w-full" />
                                <p class="text-xs text-gray-600">
                                    Total of adults 
                                </p>
                            </div>
                            <div>
                                <label for="adult_selling_price" class="block text-gray-700 font-semibold">Selling Price</label>
                                <input type="number" id="adult_selling_price" name="adult_selling_price" class="mt-1 p-2 border border-gray-500 rounded w-full selling-price" oninput="calculateCommission(document.getElementById('adult-row'))" />
                            </div>
                            <div>
                                <label for="adult_agent_price" class="block text-gray-700 font-semibold">Agent Price</label>
                                <input type="number" id="adult_agent_price" name="adult_agent_price" class="mt-1 p-2 border border-gray-500 rounded w-full agent-price" oninput="calculateCommission(document.getElementById('adult-row'))" />
                            </div>
                            <!-- Commission (Price) -->
                            <div>
                                <label for="adult_commission_price" class="block text-gray-700 font-semibold">Commission (Price)</label>
                                <input type="number" id="adult_commission_price" name="adult_commission_price" class="mt-1 p-2 border border-gray-500 rounded w-full bg-gray-100 commission-price" readonly />
                            </div>

                            <!-- Commission (%) -->
                            <div>
                                <label for="adult_commission_percent" class="block text-gray-700 font-semibold">Commission (%)</label>
                                <input type="number" id="adult_commission_percent" name="adult_commission_percent" class="mt-1 p-2 border border-gray-500 rounded w-full bg-gray-100 commission-percent" readonly />
                            </div>
                        </div>
                    
                        <p class="font-semibold text-md">Children Price</p>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4" id="children-row">
                            <div>
                                <label for="children_number" class="block text-gray-700 font-semibold">Number of Children</label>
                                <input type="number" id="children_number" name="children_number" class="mt-1 p-2 border border-gray-500 rounded w-full" />
                            </div>
                            <div>
                                <label for="children_selling_price" class="block text-gray-700 font-semibold">Selling Price</label>
                                <input type="number" id="children_selling_price" name="children_selling_price" class="mt-1 p-2 border border-gray-500 rounded w-full selling-price" oninput="calculateCommission(document.getElementById('children-row'))" />
                            </div>
                            <div>
                                <label for="children_agent_price" class="block text-gray-700 font-semibold">Agent Price</label>
                                <input type="number" id="children_agent_price" name="children_agent_price" class="mt-1 p-2 border border-gray-500 rounded w-full agent-price" oninput="calculateCommission(document.getElementById('children-row'))" />
                            </div>
                            <div>
                                <label for="children_commission_percent" class="block text-gray-700 font-semibold">Commission (Price (%)) </label>
                                <input type="text" id="children_commission_percent" name="children_commission_percent" class="mt-1 p-2 border border-gray-500 rounded w-full bg-gray-100 commission" readonly />
                            </div>
                        </div>
                         <!-- Actions -->
                         <div class="flex justify-between space-x-2 mt-4">
                            <button type="button" class="bg-red-700 text-white px-4 py-2 rounded flex items-center space-x-2">
                                <a href="{% url 'pack_form' merchant_id=product.package_merchant.id %}" class="flex items-center space-x-2 font-semibold">
                                    <i class="fas fa-times"></i>
                                    <span>Cancel</span>
                                </a>
                            </button>
                            <button type="submit" class="bg-green-700 text-white px-4 py-2 rounded flex items-center space-x-2 font-semibold">
                                <i class="fas fa-save"></i>
                                <span>Save</span>
                            </button>
                        </div>
                        <!-- <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded">Save</button> -->
                    </form>
                </div>
            </div>
        </div>
    </div>
</body>
</html>

<script>
    // Function to calculate commission
    function calculateCommission(row) {
        const sellingPrice = parseFloat(row.querySelector('.selling-price').value) || 0;
        const agentPrice = parseFloat(row.querySelector('.agent-price').value) || 0;
        const commissionPriceField = row.querySelector('.commission-price');
        const commissionPercentField = row.querySelector('.commission-percent');

        if (sellingPrice > 0 && agentPrice >= 0) {
            const difference = sellingPrice - agentPrice; // Commission (Price)
            const percentage = (difference / sellingPrice) * 100; // Commission (%)

            commissionPriceField.value = difference.toFixed(2); // Set the Commission (Price) field
            commissionPercentField.value = percentage.toFixed(2); // Set the Commission (%) field
        } else {
            // Clear fields if values are invalid
            commissionPriceField.value = '';
            commissionPercentField.value = '';
        }
    }
</script>
{% endblock %}